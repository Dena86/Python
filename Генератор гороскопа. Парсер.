import tkinter as tk
from tkinter import ttk, messagebox, scrolledtext
from typing import Dict, List, Optional, Tuple
import random
import requests
from bs4 import BeautifulSoup
import sys
from datetime import datetime

class HoroscopeApp:
    def __init__(self, root: tk.Tk):
        self.root = root
        self.root.title("–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–≥–æ –≥–æ—Ä–æ—Å–∫–æ–ø–∞")
        self.root.geometry("900x700")
        self.root.minsize(700, 600)
        
        self.signs = {
            '–æ–≤–µ–Ω': ('aries', 'üî•', '–ú–∞—Ä—Å', '—Å–º–µ–ª–æ—Å—Ç—å, –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞'),
            '—Ç–µ–ª–µ—Ü': ('taurus', 'üåø', '–í–µ–Ω–µ—Ä–∞', '–Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å, –ø—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å'),
            '–±–ª–∏–∑–Ω–µ—Ü—ã': ('gemini', 'üå¨Ô∏è', '–ú–µ—Ä–∫—É—Ä–∏–π', '–æ–±—â–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –ª—é–±–æ–∑–Ω–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å'),
            '—Ä–∞–∫': ('cancer', 'üåä', '–õ—É–Ω–∞', '—á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –∏–Ω—Ç—É–∏—Ü–∏—è'),
            '–ª–µ–≤': ('leo', '‚òÄÔ∏è', '–°–æ–ª–Ω—Ü–µ', '—â–µ–¥—Ä–æ—Å—Ç—å, —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ'),
            '–¥–µ–≤–∞': ('virgo', 'üåæ', '–ú–µ—Ä–∫—É—Ä–∏–π', '–∞–Ω–∞–ª–∏—Ç–∏—á–Ω–æ—Å—Ç—å, –≤–Ω–∏–º–∞–Ω–∏–µ –∫ –¥–µ—Ç–∞–ª—è–º'),
            '–≤–µ—Å—ã': ('libra', '‚öñÔ∏è', '–í–µ–Ω–µ—Ä–∞', '–≥–∞—Ä–º–æ–Ω–∏—è, –¥–∏–ø–ª–æ–º–∞—Ç–∏—è'),
            '—Å–∫–æ—Ä–ø–∏–æ–Ω': ('scorpio', 'ü¶Ç', '–ü–ª—É—Ç–æ–Ω', '—Å—Ç—Ä–∞—Å—Ç—å, –ø—Ä–æ–Ω–∏—Ü–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å'),
            '—Å—Ç—Ä–µ–ª–µ—Ü': ('sagittarius', 'üèπ', '–Æ–ø–∏—Ç–µ—Ä', '–æ–ø—Ç–∏–º–∏–∑–º, –∞–≤–∞–Ω—Ç—é—Ä–∏–∑–º'),
            '–∫–æ–∑–µ—Ä–æ–≥': ('capricorn', '‚õ∞Ô∏è', '–°–∞—Ç—É—Ä–Ω', '–¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞, –∞–º–±–∏—Ü–∏–æ–∑–Ω–æ—Å—Ç—å'),
            '–≤–æ–¥–æ–ª–µ–π': ('aquarius', 'üåÄ', '–£—Ä–∞–Ω', '–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å, –≥—É–º–∞–Ω–∏–∑–º'),
            '—Ä—ã–±—ã': ('pisces', 'üê†', '–ù–µ–ø—Ç—É–Ω', '—Å–æ—Å—Ç—Ä–∞–¥–∞–Ω–∏–µ, –º–µ—á—Ç–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å')
        }
        
        self.planets = {
            '–°–æ–ª–Ω—Ü–µ': '–ª–∏—á–Ω–æ—Å—Ç—å, –∂–∏–∑–Ω–µ–Ω–Ω–∞—è —Å–∏–ª–∞',
            '–õ—É–Ω–∞': '—ç–º–æ—Ü–∏–∏, –ø–æ–¥—Å–æ–∑–Ω–∞–Ω–∏–µ',
            '–ú–µ—Ä–∫—É—Ä–∏–π': '–∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è, –º—ã—à–ª–µ–Ω–∏–µ',
            '–í–µ–Ω–µ—Ä–∞': '–ª—é–±–æ–≤—å, —Ü–µ–Ω–Ω–æ—Å—Ç–∏',
            '–ú–∞—Ä—Å': '—ç–Ω–µ—Ä–≥–∏—è, –¥–µ–π—Å—Ç–≤–∏—è',
            '–Æ–ø–∏—Ç–µ—Ä': '—É–¥–∞—á–∞, —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ',
            '–°–∞—Ç—É—Ä–Ω': '–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è, –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞',
            '–£—Ä–∞–Ω': '–∏–∑–º–µ–Ω–µ–Ω–∏—è, –∏–Ω–Ω–æ–≤–∞—Ü–∏–∏',
            '–ù–µ–ø—Ç—É–Ω': '–∏–Ω—Ç—É–∏—Ü–∏—è, –¥—É—Ö–æ–≤–Ω–æ—Å—Ç—å',
            '–ü–ª—É—Ç–æ–Ω': '—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è, –≤–æ–∑—Ä–æ–∂–¥–µ–Ω–∏–µ'
        }
        
        self.themes = {
            '–ª—é–±–æ–≤—å': ['—Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ –≤—Å—Ç—Ä–µ—á–∏', '–≥–∞—Ä–º–æ–Ω–∏—è –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö', '–Ω–æ–≤—ã–µ –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞'],
            '–∫–∞—Ä—å–µ—Ä–∞': ['–ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ —É—Å–ø–µ—Ö–∏', '–≤–∞–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è', '—Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ'],
            '—Ñ–∏–Ω–∞–Ω—Å—ã': ['—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏', '–∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏', '–±—é–¥–∂–µ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ'],
            '–∑–¥–æ—Ä–æ–≤—å–µ': ['—Ñ–∏–∑–∏—á–µ—Å–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å', '–¥—É—à–µ–≤–Ω–æ–µ —Ä–∞–≤–Ω–æ–≤–µ—Å–∏–µ', '—Ä–µ–∂–∏–º –¥–Ω—è'],
            '—Å–µ–º—å—è': ['–≤–∑–∞–∏–º–æ–ø–æ–Ω–∏–º–∞–Ω–∏–µ', '—Å–æ–≤–º–µ—Å—Ç–Ω—ã–µ –ø–ª–∞–Ω—ã', '–ø–æ–¥–¥–µ—Ä–∂–∫–∞ –±–ª–∏–∑–∫–∏—Ö'],
            '—Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ': ['–≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ', '–Ω–æ–≤—ã–µ –ø—Ä–æ–µ–∫—Ç—ã', '—Å–∞–º–æ–≤—ã—Ä–∞–∂–µ–Ω–∏–µ']
        }
        
        self.advice_types = {
            '–∞—Å—Ç—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π': '–° —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –∑–≤–µ–∑–¥',
            '–Ω—É–º–µ—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π': '–ü–æ –Ω—É–º–µ—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–º —Ä–∞—Å—á–µ—Ç–∞–º',
            '—Ç–∞—Ä–æ': '–ö–∞—Ä—Ç—ã –¢–∞—Ä–æ —Å–æ–≤–µ—Ç—É—é—Ç',
            '—ç–∑–æ—Ç–µ—Ä–∏—á–µ—Å–∫–∏–π': '–° –¥—É—Ö–æ–≤–Ω–æ–π —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è'
        }
        
        self.setup_styles()
        self.create_widgets()
        self.center_window()
        self.root.protocol("WM_DELETE_WINDOW", self.on_close)
    
    def setup_styles(self):
        style = ttk.Style()
        style.theme_use('clam')
        
        style.configure(".", font=("Segoe UI", 10))
        style.configure("TFrame", background="#f8f9fa")
        style.configure("TLabel", background="#f8f9fa")
        style.configure("TButton", padding=6)
        style.configure("Header.TLabel", font=("Segoe UI", 14, "bold"), foreground="#2c3e50")
        style.configure("Result.TFrame", background="#ffffff", relief=tk.SUNKEN, borderwidth=1)
        
        style.map("TButton",
            foreground=[("active", "#2c3e50"), ("!active", "#2c3e50")],
            background=[("active", "#e9ecef"), ("!active", "#f8f9fa")],
        )
    
    def create_widgets(self):
        main_frame = ttk.Frame(self.root, padding=15)
        main_frame.pack(fill=tk.BOTH, expand=True)
        
        header_frame = ttk.Frame(main_frame)
        header_frame.pack(fill=tk.X, pady=(0, 20))
        
        ttk.Label(
            header_frame,
            text="–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–≥–æ –≥–æ—Ä–æ—Å–∫–æ–ø–∞",
            style="Header.TLabel"
        ).pack(side=tk.LEFT)
        
        input_frame = ttk.LabelFrame(main_frame, text=" –í–∞—à–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ ", padding=15)
        input_frame.pack(fill=tk.X, pady=(0, 20))
        
        ttk.Label(input_frame, text="–í–∞—à–µ –∏–º—è:").grid(row=0, column=0, sticky=tk.W, padx=5, pady=5)
        self.name_entry = ttk.Entry(input_frame, width=30)
        self.name_entry.grid(row=0, column=1, sticky=tk.EW, padx=5, pady=5)
        
        ttk.Label(input_frame, text="–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è (–¥–¥.–º–º):").grid(row=1, column=0, sticky=tk.W, padx=5, pady=5)
        self.birth_entry = ttk.Entry(input_frame, width=10)
        self.birth_entry.grid(row=1, column=1, sticky=tk.W, padx=5, pady=5)
        
        generate_btn = ttk.Button(
            input_frame,
            text="üîÆ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≥–æ—Ä–æ—Å–∫–æ–ø",
            command=self.generate_horoscope
        )
        generate_btn.grid(row=2, column=0, columnspan=2, pady=10)
        
        self.notebook = ttk.Notebook(main_frame)
        self.notebook.pack(fill=tk.BOTH, expand=True)
        
        self.create_general_tab()
        self.create_advice_tab()
        self.create_details_tab()
        self.create_compatibility_tab()
        
        self.status_var = tk.StringVar()
        status_bar = ttk.Label(
            main_frame,
            textvariable=self.status_var,
            relief=tk.SUNKEN,
            anchor=tk.W,
            padding=5
        )
        status_bar.pack(fill=tk.X, pady=(10, 0))
    
    def create_general_tab(self):
        self.general_tab = ttk.Frame(self.notebook)
        self.notebook.add(self.general_tab, text="–û–±—â–∏–π –ø—Ä–æ–≥–Ω–æ–∑")
        
        self.general_text = scrolledtext.ScrolledText(
            self.general_tab,
            wrap=tk.WORD,
            font=("Segoe UI", 11),
            padx=15,
            pady=15,
            state=tk.DISABLED,
            background="#ffffff",
            foreground="#2c3e50"
        )
        self.general_text.pack(fill=tk.BOTH, expand=True)
    
    def create_advice_tab(self):
        self.advice_tab = ttk.Frame(self.notebook)
        self.notebook.add(self.advice_tab, text="–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Å–æ–≤–µ—Ç—ã")
        
        self.advice_text = scrolledtext.ScrolledText(
            self.advice_tab,
            wrap=tk.WORD,
            font=("Segoe UI", 11),
            padx=15,
            pady=15,
            state=tk.DISABLED,
            background="#ffffff",
            foreground="#2c3e50"
        )
        self.advice_text.pack(fill=tk.BOTH, expand=True)
    
    def create_details_tab(self):
        self.details_tab = ttk.Frame(self.notebook)
        self.notebook.add(self.details_tab, text="–ê—Å—Ç—Ä–æ–¥–µ—Ç–∞–ª–∏")
        
        self.details_text = scrolledtext.ScrolledText(
            self.details_tab,
            wrap=tk.WORD,
            font=("Segoe UI", 11),
            padx=15,
            pady=15,
            state=tk.DISABLED,
            background="#ffffff",
            foreground="#2c3e50"
        )
        self.details_text.pack(fill=tk.BOTH, expand=True)
    
    def create_compatibility_tab(self):
        self.compat_tab = ttk.Frame(self.notebook)
        self.notebook.add(self.compat_tab, text="–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å")
        
        self.compat_text = scrolledtext.ScrolledText(
            self.compat_tab,
            wrap=tk.WORD,
            font=("Segoe UI", 11),
            padx=15,
            pady=15,
            state=tk.DISABLED,
            background="#ffffff",
            foreground="#2c3e50"
        )
        self.compat_text.pack(fill=tk.BOTH, expand=True)
    
    def calculate_zodiac_sign(self, day: int, month: int) -> Optional[Tuple[str, str]]:
        if (month == 3 and day >= 21) or (month == 4 and day <= 19):
            return '–æ–≤–µ–Ω'
        elif (month == 4 and day >= 20) or (month == 5 and day <= 20):
            return '—Ç–µ–ª–µ—Ü'
        elif (month == 5 and day >= 21) or (month == 6 and day <= 20):
            return '–±–ª–∏–∑–Ω–µ—Ü—ã'
        elif (month == 6 and day >= 21) or (month == 7 and day <= 22):
            return '—Ä–∞–∫'
        elif (month == 7 and day >= 23) or (month == 8 and day <= 22):
            return '–ª–µ–≤'
        elif (month == 8 and day >= 23) or (month == 9 and day <= 22):
            return '–¥–µ–≤–∞'
        elif (month == 9 and day >= 23) or (month == 10 and day <= 22):
            return '–≤–µ—Å—ã'
        elif (month == 10 and day >= 23) or (month == 11 and day <= 21):
            return '—Å–∫–æ—Ä–ø–∏–æ–Ω'
        elif (month == 11 and day >= 22) or (month == 12 and day <= 21):
            return '—Å—Ç—Ä–µ–ª–µ—Ü'
        elif (month == 12 and day >= 22) or (month == 1 and day <= 19):
            return '–∫–æ–∑–µ—Ä–æ–≥'
        elif (month == 1 and day >= 20) or (month == 2 and day <= 18):
            return '–≤–æ–¥–æ–ª–µ–π'
        elif (month == 2 and day >= 19) or (month == 3 and day <= 20):
            return '—Ä—ã–±—ã'
        return None
    
    def _scrape_horoscope(self, sign_en: str) -> str:
        try:
            url = f"https://www.horoscope.com/us/horoscopes/general/horoscope-general-daily.aspx?sign={sign_en}"
            headers = {'User-Agent': 'Mozilla/5.0'}
            response = requests.get(url, headers=headers, timeout=10)
            response.raise_for_status()
            
            soup = BeautifulSoup(response.text, 'html.parser')
            horoscope = soup.find('div', class_='main-horoscope')
            if horoscope:
                return horoscope.get_text(strip=True)
            
        except Exception as e:
            print(f"–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞: {e}", file=sys.stderr)
        
        return (
            f"–°–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –¥–µ–Ω—å –ø—Ä–∏–Ω–µ—Å–µ—Ç {random.choice(['–Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ', '—Ä–∞–¥–æ—Å—Ç–Ω—ã–µ', '–∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ'])} —Å–æ–±—ã—Ç–∏—è. "
            f"–ó–≤–µ–∑–¥—ã —Å–æ–≤–µ—Ç—É—é—Ç –ø—Ä–æ—è–≤–∏—Ç—å {random.choice(['–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å', '–∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—É', '—Ç–µ—Ä–ø–µ–Ω–∏–µ'])} "
            f"–≤ –≤–æ–ø—Ä–æ—Å–∞—Ö, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å {random.choice(['–ª–∏—á–Ω—ã–º–∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è–º–∏', '—Ñ–∏–Ω–∞–Ω—Å–∞–º–∏', '–∫–∞—Ä—å–µ—Ä–æ–π'])}. "
            f"–ë–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è {random.choice(['–Ω–æ–≤—ã—Ö –Ω–∞—á–∏–Ω–∞–Ω–∏–π', '–∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å—Ç–∞—Ä—ã—Ö –¥–µ–ª', '—Å–∞–º–æ—Ä–∞–∑–≤–∏—Ç–∏—è'])}."
        )
    
    def _generate_detailed_advice(self, name: str, sign: str) -> List[str]:
        sign_data = self.signs.get(sign, ('', 'üåü', '', ''))
        sign_emoji = sign_data[1]
        ruling_planet = sign_data[2]
        
        name_number = sum(ord(c.lower()) - ord('–∞') + 1 for c in name if c.isalpha()) % 9 or 9
        
        advice = [
            f"{sign_emoji} {random.choice(list(self.advice_types.values()))}: "
            f"{random.choice(['–í–∞—à –¥–µ–Ω—å –Ω–∞—á–Ω–µ—Ç—Å—è —Å –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ–≥–æ —Å–æ–±—ã—Ç–∏—è', 
                            '–°–µ–≥–æ–¥–Ω—è —Å—Ç–æ–∏—Ç –ø—Ä–∏—Å–ª—É—à–∞—Ç—å—Å—è –∫ —Å–≤–æ–µ–π –∏–Ω—Ç—É–∏—Ü–∏–∏',
                            '–ó–≤–µ–∑–¥—ã –±–ª–∞–≥–æ—Å–∫–ª–æ–Ω–Ω—ã –∫ –≤–∞—à–∏–º –Ω–∞—á–∏–Ω–∞–Ω–∏—è–º'])}",
            
            f"üî¢ –ù—É–º–µ—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å–æ–≤–µ—Ç (—á–∏—Å–ª–æ {name_number}): "
            f"{random.choice(['–°–µ–≥–æ–¥–Ω—è –≤–∞—à —Å—á–∞—Å—Ç–ª–∏–≤—ã–π –¥–µ–Ω—å', 
                            '–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –∑–Ω–∞–∫–∏ —Å—É–¥—å–±—ã',
                            '–ß–∏—Å–ª–æ –¥–Ω—è –ø—Ä–∏–Ω–µ—Å–µ—Ç –≤–∞–º —É–¥–∞—á—É'])}",
            
            f"ü™ê –í–ª–∏—è–Ω–∏–µ {ruling_planet}: "
            f"{random.choice(['—É—Å–∏–ª–∏—Ç –≤–∞—à—É –∏–Ω—Ç—É–∏—Ü–∏—é', 
                            '–ø–æ–º–æ–∂–µ—Ç –≤ –ø—Ä–∏–Ω—è—Ç–∏–∏ —Ä–µ—à–µ–Ω–∏–π',
                            '–ø—Ä–∏–Ω–µ—Å–µ—Ç —Ç–≤–æ—Ä—á–µ—Å–∫–æ–µ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ'])}",
            
            f"üí´ {name}, —Å–µ–≥–æ–¥–Ω—è –æ—Å–æ–±–µ–Ω–Ω–æ –≤–∞–∂–Ω–æ: "
            f"{random.choice(['–ø—Ä–æ—è–≤–∏—Ç—å –≥–∏–±–∫–æ—Å—Ç—å –≤ –æ–±—â–µ–Ω–∏–∏', 
                            '—Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–∏—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω–æ–º',
                            '–Ω–µ –±–æ—è—Ç—å—Å—è –ø–µ—Ä–µ–º–µ–Ω'])}",
            
            f"üåü –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –¥–Ω—è: "
            f"{random.choice(['–ù–∞–π–¥–∏—Ç–µ –≤—Ä–µ–º—è –¥–ª—è —Å–µ–±—è', 
                            '–ü—Ä–æ—è–≤–∏—Ç–µ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—É –Ω–∞ —Ä–∞–±–æ—Ç–µ',
                            '–ü–æ–±–∞–ª—É–π—Ç–µ —Å–µ–±—è —á–µ–º-—Ç–æ –ø—Ä–∏—è—Ç–Ω—ã–º'])}"
        ]
        
        return advice
    
    def _generate_compatibility(self, sign: str) -> str:
        compatible_signs = random.sample(list(self.signs.keys()), 3)
        incompatible_signs = random.sample(
            [s for s in self.signs.keys() if s not in compatible_signs], 
            2
        )
        
        return (
            f"–õ—É—á—à–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–µ–≥–æ–¥–Ω—è —Å: {', '.join(compatible_signs)}\n\n"
            f"–°–ª–æ–∂–Ω–æ—Å—Ç–∏ –º–æ–≥—É—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å —Å: {', '.join(incompatible_signs)}\n\n"
            f"–°–æ–≤–µ—Ç –ø–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—è–º: {random.choice([
                '–ë—É–¥—å—Ç–µ —Ç–µ—Ä–ø–∏–º—ã –∫ –º–Ω–µ–Ω–∏—é –¥—Ä—É–≥–∏—Ö',
                '–ü—Ä–æ—è–≤–∏—Ç–µ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—É –≤ –æ–±—â–µ–Ω–∏–∏',
                '–ò–∑–±–µ–≥–∞–π—Ç–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å–µ–≥–æ–¥–Ω—è'
            ])}"
        )
    
    def generate_horoscope(self):
        name = self.name_entry.get().strip()
        birth_date = self.birth_entry.get().strip()
        
        if not name or not birth_date:
            messagebox.showwarning("–û—à–∏–±–∫–∞", "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∏–º—è –∏ –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è")
            return
        
        try:
            day, month = map(int, birth_date.split('.'))
            if not (1 <= day <= 31 and 1 <= month <= 12):
                raise ValueError
        except ValueError:
            messagebox.showerror("–û—à–∏–±–∫–∞", "–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–¥.–º–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, 15.04)")
            return
        
        try:
            sign = self.calculate_zodiac_sign(day, month) or random.choice(list(self.signs.keys()))
            sign_data = self.signs.get(sign, ('', 'üåü', '', ''))
            
            general_horo = self._scrape_horoscope(sign_data[0])
            detailed_advice = self._generate_detailed_advice(name, sign)
            compatibility = self._generate_compatibility(sign)
            
            details = [
                f"üåü –ó–Ω–∞–∫ –∑–æ–¥–∏–∞–∫–∞: {sign.capitalize()} {sign_data[1]}",
                f"ü™ê –ü—Ä–∞–≤—è—â–∞—è –ø–ª–∞–Ω–µ—Ç–∞: {sign_data[2]} ({sign_data[3]})",
                f"üî¢ –°—á–∞—Å—Ç–ª–∏–≤—ã–µ —á–∏—Å–ª–∞: {', '.join(map(str, sorted(random.sample(range(1, 50), 3))))}",
                f"üåà –°—á–∞—Å—Ç–ª–∏–≤—ã–π —Ü–≤–µ—Ç: {random.choice(['–∫—Ä–∞—Å–Ω—ã–π', '—Å–∏–Ω–∏–π', '–∑–µ–ª–µ–Ω—ã–π', '–∑–æ–ª–æ—Ç–æ–π', '—Å–µ—Ä–µ–±—Ä—è–Ω—ã–π', '—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π'])}",
                f"üìÖ –ë–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω—ã–π –¥–µ–Ω—å: {random.choice(['–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', '–≤—Ç–æ—Ä–Ω–∏–∫', '—Å—Ä–µ–¥–∞', '—á–µ—Ç–≤–µ—Ä–≥', '–ø—è—Ç–Ω–∏—Ü–∞', '—Å—É–±–±–æ—Ç–∞', '–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ'])}",
                f"üíé –ö–∞–º–µ–Ω—å-—Ç–∞–ª–∏—Å–º–∞–Ω: {random.choice(['–∞–º–µ—Ç–∏—Å—Ç', '—Ä—É–±–∏–Ω', '–∏–∑—É–º—Ä—É–¥', '—Å–∞–ø—Ñ–∏—Ä', '—Ç–æ–ø–∞–∑', '–≥—Ä–∞–Ω–∞—Ç', '–∂–µ–º—á—É–≥'])}",
                f"üåø –ê—Ä–æ–º–∞—Ç –¥–Ω—è: {random.choice(['–ª–∞–≤–∞–Ω–¥–∞', '–∂–∞—Å–º–∏–Ω', '—Å–∞–Ω–¥–∞–ª', '—Ä–æ–∑–º–∞—Ä–∏–Ω', '–º—è—Ç–∞', '–≤–∞–Ω–∏–ª—å'])}"
            ]
            
            self.update_result_tabs(general_horo, detailed_advice, details, compatibility)
            self.status_var.set(f"‚ú® –ì–æ—Ä–æ—Å–∫–æ–ø –¥–ª—è {name} –≥–æ—Ç–æ–≤! ‚ú®")
            
        except Exception as e:
            messagebox.showerror("–û—à–∏–±–∫–∞", f"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞: {str(e)}")
            self.status_var.set("–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≥–æ—Ä–æ—Å–∫–æ–ø–∞")
    
    def update_result_tabs(self, general: str, advice: List[str], details: List[str], compatibility: str):
        self.general_text.config(state=tk.NORMAL)
        self.general_text.delete(1.0, tk.END)
        self.general_text.insert(tk.END, general)
        self.general_text.config(state=tk.DISABLED)
        
        self.advice_text.config(state=tk.NORMAL)
        self.advice_text.delete(1.0, tk.END)
        self.advice_text.insert(tk.END, "\n\n".join(advice))
        self.advice_text.config(state=tk.DISABLED)
        
        self.details_text.config(state=tk.NORMAL)
        self.details_text.delete(1.0, tk.END)
        self.details_text.insert(tk.END, "\n\n".join(details))
        self.details_text.config(state=tk.DISABLED)
        
        self.compat_text.config(state=tk.NORMAL)
        self.compat_text.delete(1.0, tk.END)
        self.compat_text.insert(tk.END, compatibility)
        self.compat_text.config(state=tk.DISABLED)
    
    def center_window(self):
        self.root.update_idletasks()
        width = self.root.winfo_width()
        height = self.root.winfo_height()
        x = (self.root.winfo_screenwidth() // 2) - (width // 2)
        y = (self.root.winfo_screenheight() // 2) - (height // 2)
        self.root.geometry(f"{width}x{height}+{x}+{y}")
    
    def on_close(self):
        if messagebox.askokcancel("–í—ã—Ö–æ–¥", "–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?"):
            self.root.destroy()

def main():
    root = tk.Tk()
    app = HoroscopeApp(root)
    root.mainloop()

if __name__ == "__main__":
    main()
